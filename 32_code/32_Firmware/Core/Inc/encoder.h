#ifndef ENCODER_H
#define ENCODER_H

#include "main.h"

#ifndef M_PI
#define M_PI 3.1415926535f
#endif

/* ====================================================================== */
/* ==============     统一的机器人核心物理参数定义         ============== */
/* ====================================================================== */

/**
 * @brief 编码器每转一圈的脉冲数 (电机经过减速箱后，在输出轴上测得的)
 */
#define ENCODER_PPR 1560.0f

/**
 * @brief 驱动轮的直径 (单位: 米), 请用卡尺等工具精确测量。
 * 示例: 0.2105f (周长) / 3.14159f ≈ 0.067f (直径)
 */
#define WHEEL_DIAMETER 0.067f

/**
 * @brief 轮子周长 (单位: 米), 此值根据直径自动计算。
 */
#define WHEEL_CIRCUMFERENCE (WHEEL_DIAMETER * M_PI)

/**
 * @brief 轮距 (单位: 米), 两个驱动轮中心的距离。
 * 这是影响转弯角度和里程计航向角计算准确性的最关键参数。
 * 【注意】此值需要通过实验进行精确标定！当前统一设置为 0.159f。
 */
#define WHEELBASE 0.164f


/* ====================================================================== */
/* ==============          全局变量外部声明              ============== */
/* ====================================================================== */

// 其他模块可以通过这些 'extern' 声明来访问编码器和里程计的实时数据

// 速度 (单位: m/s)，带方向符号
extern float left_speed_signed_mps;
extern float right_speed_signed_mps;

// 累计位移 (单位: m)，带方向符号
extern float left_displacement_m;
extern float right_displacement_m;

// 里程计估算的机器人位姿
extern float robot_x;            // X坐标 (m)
extern float robot_y;            // Y坐标 (m)
extern float robot_theta;        // 航向角 (rad)

/* ====================================================================== */
/* ==============              函数原型声明                ============== */
/* ====================================================================== */

/**
 * @brief 初始化编码器计数和里程计状态
 */
void Encoder_Init(void);

/**
 * @brief 更新编码器读数，并计算速度和里程计位姿
 * @note  此函数应以固定的时间间隔(例如10ms)被调用
 */
void Encoder_Update(void);

#endif /* ENCODER_H */